<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Chat Analytics</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>RR Chit-Chat Analytics</h1>
        <p class="subtitle">Insights generated from the exported WhatsApp group conversation.</p>
    </header>

    <main>
        <nav class="section-nav full-span" aria-label="Section shortcuts">
            <div class="section-nav-inner">
                <a href="#summary">Overview</a>
                <a href="#insight-highlights">Highlights</a>
                <a href="#saved-views-card">Saved Views</a>
                <a href="#daily-activity">Daily</a>
                <a href="#weekly-trend">Weekly</a>
                <a href="#weekday-trend">Weekday</a>
                <a href="#timeofday-trend">Time of Day</a>
                <a href="#sentiment-overview">Sentiment</a>
                <a href="#message-types">System &amp; Types</a>
            </div>
        </nav>

        <div class="page-controls full-span">
            <div class="control-row primary-controls">
                <label class="control upload-control">
                    <span>Chat import</span>
                    <input type="file" id="chat-file" accept=".txt">
                </label>
                <div class="control custom-range hidden" id="custom-range-controls">
                    <span>Custom range</span>
                    <div class="custom-range-inputs">
                        <input type="date" id="custom-start" disabled>
                        <span class="range-separator">to</span>
                        <input type="date" id="custom-end" disabled>
                        <button type="button" class="ghost-button small" id="apply-custom-range" disabled>Apply</button>
                    </div>
                </div>
                <label class="control period-control">
                    <span>Period</span>
                    <select id="global-range">
                        <option value="all">All time</option>
                        <option value="30">Last 30 days</option>
                        <option value="90">Last 90 days</option>
                        <option value="180">Last 180 days</option>
                        <option value="365">Last 365 days</option>
                        <option value="custom">Custom range</option>
                    </select>
                </label>
            </div>
            <div class="control-row page-actions">
                <button type="button" class="ghost-button" id="download-pdf">Download PDF</button>
                <button type="button" class="ghost-button" id="share-snapshot">Share Snapshot</button>
                <button type="button" class="ghost-button" id="download-markdown-report">Markdown Report</button>
                <button type="button" class="ghost-button" id="download-slides-report">Slides (HTML)</button>
            </div>
        </div>

        <p id="data-status" class="status full-span"></p>

        <section id="summary" class="card-grid summary full-span"></section>

        <section class="card full-span highlights" id="insight-highlights">
            <div class="card-header">
                <div class="card-title-group">
                    <h2>Quick Highlights</h2>
                    <button type="button" class="card-toggle" aria-expanded="true" data-target="insight-highlights-content">▾</button>
                </div>
            </div>
            <div class="card-content" id="insight-highlights-content">
                <div class="highlight-grid" id="highlight-list"></div>
            </div>
        </section>

        <section class="card full-span saved-views" id="saved-views-card">
            <div class="card-header">
                <div class="card-title-group">
                    <h2>Saved Views &amp; Sessions</h2>
                    <button type="button" class="card-toggle" aria-expanded="true" data-target="saved-views-content">▾</button>
                </div>
            </div>
            <div class="card-content" id="saved-views-content">
                <div class="saved-view-actions">
                    <div class="saved-view-save">
                        <label for="saved-view-name">Name</label>
                        <input type="text" id="saved-view-name" placeholder="e.g. Last 30d weekdays">
                        <button type="button" class="ghost-button" id="save-view">Save Current View</button>
                    </div>
                    <div class="saved-view-manage">
                        <label class="control-group" for="saved-view-list">
                            <span>Saved Views</span>
                            <select id="saved-view-list"></select>
                        </label>
                        <button type="button" class="ghost-button small" id="apply-saved-view">Apply</button>
                        <button type="button" class="ghost-button small" id="delete-saved-view">Delete</button>
                    </div>
                </div>
                <div class="compare-controls" id="compare-controls">
                    <div class="compare-select">
                        <label for="compare-view-a">View A</label>
                        <select id="compare-view-a"></select>
                    </div>
                    <div class="compare-select">
                        <label for="compare-view-b">View B</label>
                        <select id="compare-view-b"></select>
                    </div>
                    <button type="button" class="ghost-button" id="compare-views">Compare</button>
                </div>
                <div class="compare-summary" id="compare-summary"></div>
            </div>
        </section>

        <section class="card full-span search-panel">
            <div class="card-header">
                <div class="card-title-group">
                    <h2>Advanced Message Search</h2>
                    <div class="card-header-actions">
                        <button type="button" class="ghost-button" id="download-search-results">Download CSV</button>
                        <button type="button" class="card-toggle" aria-expanded="true" data-target="search-panel-content">▾</button>
                    </div>
                </div>
            </div>
            <div class="card-content" id="search-panel-content">
                <p class="section-note">Use keywords, participant filters, and optional date window to surface raw messages.</p>
                <form id="advanced-search-form" class="search-controls">
                    <div class="search-control">
                        <label for="search-keyword">Keywords</label>
                        <input type="text" id="search-keyword" placeholder="e.g. launch plan" autocomplete="off">
                    </div>
                    <div class="search-control">
                        <label for="search-participant">Participant</label>
                        <select id="search-participant">
                            <option value="">All participants</option>
                        </select>
                    </div>
                    <div class="search-control">
                        <label for="search-start">Start date</label>
                        <input type="date" id="search-start">
                    </div>
                    <div class="search-control">
                        <label for="search-end">End date</label>
                        <input type="date" id="search-end">
                    </div>
                    <div class="search-actions">
                        <button type="submit" class="ghost-button">Search</button>
                        <button type="button" class="ghost-button" id="reset-search">Reset</button>
                    </div>
                </form>
                <div class="search-results-summary" id="search-results-summary">Enter filters to search messages.</div>
                <div class="search-results-list" id="search-results-list"></div>
            </div>
        </section>

        <section class="card full-span participants">
            <div class="card-header">
                <div class="card-title-group">
                    <h2>Participants</h2>
                    <div class="card-header-actions">
                        <button type="button" class="ghost-button" id="download-participants">Download CSV</button>
                        <button type="button" class="card-toggle" aria-expanded="true" data-target="participants-content">▾</button>
                    </div>
                </div>
            </div>
            <div class="card-content" id="participants-content">
                <p class="section-note" id="participants-note">All members ranked by number of messages sent to the group.</p>
                <div class="participants-controls">
                    <label class="control-group" for="participants-top-count">
                        <span>Show Top</span>
                        <select id="participants-top-count">
                            <option value="10">10</option>
                            <option value="25" selected>25</option>
                            <option value="50">50</option>
                            <option value="0">All</option>
                        </select>
                    </label>
                </div>
                <div class="table-container scrollable">
                    <table id="top-senders">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Participant</th>
                                <th>Messages</th>
                                <th>Share</th>
                                <th>Avg Words</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section class="card full-span" id="hourly-activity">
            <div class="card-header">
                <div class="card-title-group">
                    <h2>Hourly Activity</h2>
                    <div class="card-header-actions">
                        <button type="button" class="ghost-button" id="download-hourly">Download CSV</button>
                        <button type="button" class="card-toggle" aria-expanded="true" data-target="hourly-activity-content">▾</button>
                    </div>
                </div>
            </div>
            <div class="card-content" id="hourly-activity-content">
                <p class="section-note">Distribution of messages across the 24-hour day (local timestamps from export).</p>
                <div class="hourly-summary">
                    <div class="summary-block">
                        <span class="summary-label">Top Hour</span>
                        <span class="summary-value" id="hourly-top-hour">—</span>
                    </div>
                </div>
                <div class="hourly-controls">
                    <div class="toggle-group">
                        <span class="toggle-label">Days</span>
                        <label><input type="checkbox" id="filter-weekdays" checked> Weekdays</label>
                        <label><input type="checkbox" id="filter-weekends" checked> Weekends</label>
                    </div>
                    <div class="toggle-group">
                        <span class="toggle-label">Hours</span>
                        <label><input type="checkbox" id="filter-working" checked> Working (09-17)</label>
                        <label><input type="checkbox" id="filter-offhours" checked> Off Hours</label>
                    </div>
                    <div class="brush-group">
                        <label for="hourly-brush-start">Hour Range</label>
                        <div class="brush-inputs">
                            <input type="range" id="hourly-brush-start" min="0" max="23" value="0">
                            <input type="range" id="hourly-brush-end" min="0" max="23" value="23">
                        </div>
                        <div class="brush-labels">
                            <span id="hourly-brush-start-label">00:00</span>
                            <span>–</span>
                            <span id="hourly-brush-end-label">23:00</span>
                        </div>
                    </div>
                </div>
                <div class="hourly-filter-note" id="hourly-filter-note"></div>
                <div class="brush-summary" id="hourly-brush-summary">Select hour range to view details.</div>
                <div id="hourly-chart" class="hourly-heatmap"></div>
                <div class="hourly-anomalies" id="hourly-anomalies"></div>
            </div>
        </section>

        <section class="card full-span" id="daily-activity">
            <div class="card-header">
                <div class="card-title-group">
                    <h2>Daily Activity</h2>
                    <div class="card-header-actions">
                        <button type="button" class="ghost-button" id="download-daily">Download CSV</button>
                        <button type="button" class="card-toggle" aria-expanded="true" data-target="daily-activity-content">▾</button>
                    </div>
                </div>
            </div>
            <div class="card-content" id="daily-activity-content">
                <p class="section-note">Message volume per day across the lifespan of the chat. Hover to inspect counts.</p>
                <div class="daily-summary">
                    <div class="summary-block">
                        <span class="summary-label">Avg / Day</span>
                    <span class="summary-value" id="daily-avg-day">—</span>
                    </div>
                </div>
                <div id="daily-chart" class="calendar-chart"></div>
            </div>
        </section>

        <section class="card full-span" id="weekly-trend">
            <div class="card-header">
                <div class="card-title-group">
                    <h2>Weekly Trend</h2>
                    <div class="card-header-actions">
                        <button type="button" class="ghost-button" id="download-weekly">Download CSV</button>
                        <button type="button" class="card-toggle" aria-expanded="true" data-target="weekly-trend-content">▾</button>
                    </div>
                </div>
            </div>
            <div class="card-content" id="weekly-trend-content">
                <p class="section-note">Weekly roll-up of messages (ISO weeks).</p>
                <div class="weekly-summary">
                    <div class="summary-block">
                        <span class="summary-label">Cumulative</span>
                        <span class="summary-value" id="weekly-cumulative">—</span>
                    </div>
                    <div class="summary-block">
                        <span class="summary-label">Last 3 Weeks Avg</span>
                        <span class="summary-value" id="weekly-rolling">—</span>
                    </div>
                    <div class="summary-block">
                        <span class="summary-label">Avg / Week</span>
                        <span class="summary-value" id="weekly-average">—</span>
                    </div>
                </div>
                <div id="weekly-chart" class="weekly-chart"></div>
            </div>
        </section>

        <section class="card full-span" id="weekday-trend">
            <div class="card-header">
                <div class="card-title-group">
                    <h2>Trend by Day of the Week</h2>
                    <div class="card-header-actions">
                        <button type="button" class="ghost-button" id="download-weekday">Download CSV</button>
                        <button type="button" class="card-toggle" aria-expanded="true" data-target="weekday-trend-content">▾</button>
                    </div>
                </div>
            </div>
            <div class="card-content" id="weekday-trend-content">
                <p class="section-note">Average message volume by day of the week.</p>
                <div class="weekday-controls">
                    <div class="toggle-group">
                        <span class="toggle-label">Days</span>
                        <label class="segmented-option">
                            <input type="checkbox" id="weekday-toggle-weekdays" checked>
                            <span>Weekdays</span>
                        </label>
                        <label class="segmented-option">
                            <input type="checkbox" id="weekday-toggle-weekends" checked>
                            <span>Weekends</span>
                        </label>
                    </div>
                    <div class="toggle-group">
                        <span class="toggle-label">Hours</span>
                        <label class="segmented-option">
                            <input type="checkbox" id="weekday-toggle-working" checked>
                            <span>Working (09-17)</span>
                        </label>
                        <label class="segmented-option">
                            <input type="checkbox" id="weekday-toggle-offhours" checked>
                            <span>Off hours</span>
                        </label>
                    </div>
                    <div class="brush-group">
                        <label for="weekday-hour-start">Hour Range</label>
                        <div class="brush-inputs">
                            <input type="range" id="weekday-hour-start" min="0" max="23" value="0">
                            <input type="range" id="weekday-hour-end" min="0" max="23" value="23">
                        </div>
                        <div class="brush-labels">
                            <span id="weekday-hour-start-label">00:00</span>
                            <span>–</span>
                            <span id="weekday-hour-end-label">23:00</span>
                        </div>
                    </div>
                </div>
                <div class="weekday-filter-note" id="weekday-filter-note"></div>
                <div id="weekday-chart" class="weekday-chart"></div>
            </div>
        </section>

        <section class="card full-span" id="timeofday-trend">
            <div class="card-header">
                <div class="card-title-group">
                    <h2>Trend by Time of the Day</h2>
                    <div class="card-header-actions">
                        <button type="button" class="ghost-button" id="download-timeofday">Download CSV</button>
                        <button type="button" class="card-toggle" aria-expanded="true" data-target="timeofday-trend-content">▾</button>
                    </div>
                </div>
            </div>
            <div class="card-content" id="timeofday-trend-content">
                <p class="section-note">Average message volume by hour of the day across the selected range.</p>
                <div class="timeofday-controls">
                    <div class="toggle-group">
                        <span class="toggle-label">Include Days</span>
                        <label class="segmented-option">
                            <input type="checkbox" id="timeofday-toggle-weekdays" checked>
                            <span>Weekdays</span>
                        </label>
                        <label class="segmented-option">
                            <input type="checkbox" id="timeofday-toggle-weekends" checked>
                            <span>Weekends</span>
                        </label>
                    </div>
                    <div class="brush-group">
                        <label for="timeofday-hour-start">Focus Hours</label>
                        <div class="brush-inputs">
                            <input type="range" id="timeofday-hour-start" min="0" max="23" value="0">
                            <input type="range" id="timeofday-hour-end" min="0" max="23" value="23">
                        </div>
                        <div class="brush-labels">
                            <span id="timeofday-hour-start-label">00:00</span>
                            <span>–</span>
                            <span id="timeofday-hour-end-label">23:00</span>
                        </div>
                    </div>
                </div>
                <div class="timeofday-chart" id="timeofday-chart">
                    <div class="timeofday-sparkline" id="timeofday-sparkline"></div>
                    <div class="timeofday-band-grid" id="timeofday-bands"></div>
                    <div class="timeofday-callouts" id="timeofday-callouts"></div>
                </div>
            </div>
        </section>

        <section class="card full-span sentiment" id="sentiment-overview">
            <div class="card-header">
                <div class="card-title-group">
                    <h2>Sentiment Overview</h2>
                    <div class="card-header-actions">
                        <button type="button" class="ghost-button" id="download-sentiment">Download CSV</button>
                        <button type="button" class="card-toggle" aria-expanded="true" data-target="sentiment-overview-content">▾</button>
                    </div>
                </div>
            </div>
            <div class="card-content" id="sentiment-overview-content">
                <p class="section-note">Lexicon-based polarity (positive, neutral, negative) scored from message text. Treat as directional, not definitive.</p>
                <div class="sentiment-summary" id="sentiment-summary"></div>
                <div class="sentiment-content">
                    <div class="sentiment-trend">
                        <h3>Daily Tone</h3>
                        <p class="sentiment-note" id="sentiment-trend-note"></p>
                        <div class="sentiment-chart" id="sentiment-daily-chart"></div>
                    </div>
                    <div class="sentiment-participants">
                        <h3>Participants</h3>
                        <p class="sentiment-note">Average sentiment score (−1 to +1) for active contributors.</p>
                        <div class="sentiment-lists">
                            <div class="sentiment-list">
                                <h4>Most Positive</h4>
                                <ul id="sentiment-top-positive"></ul>
                            </div>
                            <div class="sentiment-list">
                                <h4>Most Negative</h4>
                                <ul id="sentiment-top-negative"></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="card full-span message-types" id="message-types">
            <div class="card-header">
                <div class="card-title-group">
                    <h2>Message Types</h2>
                    <div class="card-header-actions">
                        <button type="button" class="ghost-button" id="download-message-types">Download CSV</button>
                        <button type="button" class="card-toggle" aria-expanded="true" data-target="message-types-content">▾</button>
                    </div>
                </div>
            </div>
            <div class="card-content" id="message-types-content">
                <p class="section-note">Distribution of message categories with share and week-over-week change.</p>
                <div class="message-type-summary" id="message-type-summary"></div>
                <p class="message-type-note" id="message-type-note"></p>
                <div class="card-grid stats message-basics">
                    <div class="stat" data-stat="media">
                        <span class="stat-value" id="media-count">0</span>
                        <span class="stat-label">Media Messages</span>
                    </div>
                    <div class="stat" data-stat="link">
                        <span class="stat-value" id="link-count">0</span>
                        <span class="stat-label">Messages with Links</span>
                    </div>
                    <div class="stat" data-stat="poll">
                        <span class="stat-value" id="poll-count">0</span>
                        <span class="stat-label">Polls</span>
                    </div>
                    <div class="stat" data-stat="join">
                        <span class="stat-value" id="join-events">0</span>
                        <span class="stat-label">Join Events</span>
                    </div>
                    <div class="stat" data-stat="added">
                        <span class="stat-value" id="added-events">0</span>
                        <span class="stat-label">Members Added</span>
                    </div>
                    <div class="stat" data-stat="left">
                        <span class="stat-value" id="left-events">0</span>
                        <span class="stat-label">Members Left</span>
                    </div>
                    <div class="stat" data-stat="removed">
                        <span class="stat-value" id="removed-events">0</span>
                        <span class="stat-label">Members Removed</span>
                    </div>
                    <div class="stat" data-stat="changed">
                        <span class="stat-value" id="changed-events">0</span>
                        <span class="stat-label">Settings Changed</span>
                    </div>
                    <div class="stat" data-stat="other">
                        <span class="stat-value" id="other-system-events">0</span>
                        <span class="stat-label">Other System Events</span>
                    </div>
                    <div class="stat" data-stat="join-requests">
                        <span class="stat-value" id="join-requests">0</span>
                        <span class="stat-label">Join Requests</span>
                    </div>
                    <div class="stat" data-stat="avg-chars">
                        <span class="stat-value" id="avg-chars">0</span>
                        <span class="stat-label">Avg Chars / Message</span>
                    </div>
                    <div class="stat" data-stat="avg-words">
                        <span class="stat-value" id="avg-words">0</span>
                        <span class="stat-label">Avg Words / Message</span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>Data source: <code>WhatsApp Chat with RR Chit-Chat.txt</code> parsed via custom tooling.</p>
    </footer>

    <script type="module" src="js/main.js"></script>
  </body>
</html>
